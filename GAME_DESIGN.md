# ゲーム企画書
# ぺぺ鉄道 — 知と略奪のボードゲームプラットフォーム

**企画版数:** v0.3  
**作成日:** 2026年2月27日  
**ステータス:** Phase 1 & 2 実装済み・公開中 / Phase 3 企画中

---

## 0. エグゼクティブサマリー

「ぺぺ鉄道」は、サイコロ×分岐マップを核とする**Webブラウザ向けリアルタイムボードゲームプラットフォーム**である。単なる桃鉄クローンではなく、**「マップを自分たちで作れること」**を最終的な差別化軸として設計されている。

初期リリース（Ph1）では経済戦略モード、第二フェーズ（Ph2）では対戦格闘に近い「お宝争奪モード」を実装・公開済み。第三フェーズ（Ph3）では **生成AIによるマップ自動生成エンジン** を完成させ、「誰でも自分だけのボードゲームを10分で作れる」世界を目指す。

> **URL（公開中）:** https://pepetetsu-de422.web.app

---

## 1. コアコンセプト

| 軸 | 内容 |
|----|------|
| **操作の簡潔さ** | サイコロを振り、行き先を選ぶだけ。スマホ・PCどちらでも直感操作 |
| **社会的緊張感** | 友人・家族と同じ画面を囲む「みんなで見てツッコむ」体験 |
| **戦略の深度** | ルートの読み合い、カード温存、略奪タイミングの判断 |
| **マップの可能性** | 地名・グルメ・聖地・架空世界…テーマを変えれば無限に遊べる |

---

## 2. Phase 1 — クラシックモード「不動産王への道」

### 2-1. 概要

日本全国をモデルにした **33ノード×双方向グラフ** のマップ上を移動し、物件を購入・増資して総資産額を競う経済戦略ゲーム。2〜4人対応。

### 2-2. 実装済み主要機能

#### マップエンジン
- TypeScript で実装した **有向グラフ構造**（ノード + エッジ + 双方向化）
- 7地方グループ（北海道・東北・関東・中部・近畿・中国四国・九州）
- グループ独占ボーナス（全物件所有時 ×1.5 収益）
- 動的ビューボックス：全ノードを包むSVG範囲を自動計算し、画面サイズに追従

#### ターン進行
- 1〜6のサイコロアニメーション
- **選択型分岐UI**: 分岐がある場合のみルート選択パネルが出現（タップ/ホバー対応）
- アニメーション付きのコマ移動（ノード間をステップ移動）

#### ゲーム状態管理
- **Zustand** による型安全なグローバルステート
- フェーズ管理: `playing → route_selection → buying/other → settlement → game_over`
- CPU プレイヤー: 経路スコアリングによる戦略的ルート選択

#### マネタイズ設計（ゲーム内）
- 物件を3段階（屋台・商店・ビル）で段階アップグレード
- 決算サイクル（デフォルト4ラウンドごと）で全物件収益を一括徴収
- 目的地ボーナス：指定目的地への到達で一時収入

#### 技術スタック

| 要素 | 採用技術 |
|------|---------|
| UI フレームワーク | React 19 + TypeScript |
| アニメーション | Framer Motion |
| マップ操作 | react-zoom-pan-pinch |
| 状態管理 | Zustand 5 |
| ビルド | Vite 7 |
| ホスティング | Firebase Hosting |
| バージョン管理 | GitHub |

### 2-3. ゲームデザイン上の工夫

**目的地制度:** 全プレイヤー共通の「今の目的地」を設定し、最初に到達した者がボーナスを獲得。次の目的地が自動更新されることで、全員の動きに方向感が生まれ「どこへ行けばいいか分からなくなる」問題を解消している。

**分岐選択の緊張感:** ルート選択UI設計では、各選択肢ごとに「経由するマス名 → 到着マス名」の一覧を表示。「このルートを通ると相手の物件を踏む」という戦略判断が可能になっている。

---

## 3. Phase 2 — お宝争奪モード「トレジャーハント」

### 3-1. コンセプト

Ph1「資本家の戦い」に対するアンチテーゼとして設計。プレイヤーは**採掘師兼盗賊**として、地下に眠るお宝を掘り出しながら互いから奪い合う。資産管理より**即時のギャンブルと駆け引き**を楽しむモード。

> **一言コンセプト:** 「同じサイコロ・同じマップで、まったく別のゲームが遊べる」

### 3-2. ゲームシステム詳細

#### 勝利条件
- **規定数（デフォルト10個）のお宝を先に集めたプレイヤーが勝利**
- 全マス採掘完了時点でのお宝数最多が勝者（サドンデス方式）

#### 採掘（マイニング）システム

各マスは1回だけ採掘可能。止まった瞬間に確率判定が走る。

| 結果 | 確率（基本） | 内容 |
|------|------------|------|
| お宝発見 | 25% | +1 ポイント |
| レアお宝 | 低確率 | +2 ポイント |
| トラップ | — | -1 ポイント |
| ハズレ（空振り） | — | 何も起こらない |

**周辺ボーナス:** 隣接するマスがすでに採掘済みであれば、1マスにつき成功率 +25%。最大で4マス隣接なら保証100%。これにより「ハイエナ戦略」（他人が掘った周辺を狙う）が生まれ、先行者と後追いが入り混じる面白さが生まれる。

#### 略奪（スチール）システム

| タイプ | 発生条件 | 成功率 |
|--------|---------|--------|
| すれ違い略奪 | 移動経路上に他プレイヤーがいた場合 | 30% |
| 同マス停止略奪 | 相手のいるマスにぴったり止まった場合 | 60% |
| カウンター | 略奪失敗時・相手の迎撃判定 | 失敗率の50% |

#### カードシステム

マップ上に点在するカードマス（🃏 青色）に止まると、6種類から1枚ランダム獲得。

| カード | タイプ | 効果 |
|--------|--------|------|
| ⚔️ 略奪のお守り | **パッシブ** | 所持中は略奪成功率 +15%（複数枚重複可） |
| 🧸 身代わり人形 | **パッシブ** | 略奪を1回だけ自動防衛（その後消滅） |
| 🏺 封印のツボ | アクティブ | 対象を3ターン採掘不可にする |
| 🔨 ぶっ飛ばしハンマー | アクティブ | 対象をランダムノードにワープ |
| ⚡ ビリビリ罠 | アクティブ | 対象を1ターン行動不能にする |
| ⌚ タイムマシン | アクティブ | 自分の採掘済みマスを1つ未採掘に戻す |

#### 4人制強制ルール

「お宝争奪」は接触頻度が命。人間1人でも **CPU3人が自動参加** し、常に4人がマップを動き回る。これにより略奪イベントが高頻度で発生し、見ている側も飽きない展開が続く。

### 3-3. 専用マップシステム

Ph2からクラシックモードの日本地図と別に、**お宝ハント専用マップを3種**搭載。ロビーで選択可能。

| マップ名 | 構造 | 戦略的特徴 |
|---------|------|----------|
| 🏝️ **五つの島** | 正方形四隅＋中央に 3×3 クラスター | 中央クラスター制圧 vs 外周包囲の二択構造 |
| 🌉 **二大陸** | 左右2つの大陸＋橋2本 | 橋の争奪が勝敗を左右。狭い橋で乱戦多発 |
| 🔥 **環状列島** | 6クラスターがリング状に連結 | 一周しながら採掘。追いかけっこが大渋滞 |

**マップ設計技術:** `createCluster(cx, cy, spacing, startId)` ヘルパーで 3×3 グリッドノード群を自動生成。クラスター間は「回廊ノード」（一部カードマス化）で接続。数十行のコードで多様なマップ構造を宣言的に定義できる基盤が完成している。

### 3-4. UX の工夫

**CPU ダイアログ自動進行:** CPU プレイヤーの採掘/略奪/カード取得ダイアログは 2 秒後に自動クローズ。手番のテンポが大幅に改善され、人間側が「見て楽しむ」体験に最適化。

**ゲームログパネル（右下ワイプ）:** チャット形式のログが画面右下に常駐。「○○がお宝を略奪！」「○○の身代わり人形が発動！」をリアルタイムに追えるため、画面外のプレイヤーの行動も把握できる観戦体験を提供。

---

## 4. Phase 3 — マップ生成エンジン「WorldBuilder」（次期開発）

### 4-1. ビジョン

> **「10分のプロンプト入力で、自分だけのボードゲームが生まれる」**

Ph3 では、生成AI（LLM）を活用した **マップ自動生成パイプライン** を構築する。ユーザーはテーマを入力するだけで、個性的なノード群とグラフ構造を持つ遊べるマップが出力される。

### 4-2. ユースケース例

| テーマ入力 | 期待されるマップ |
|-----------|---------------|
| 「下北沢カレー屋トップ30でマップを作って」 | 南口・一番街・東口の3ゾーンに分かれたグルメマップ |
| 「ドラマ○○の聖地巡りマップ」 | 話数順の物語ルートを骨格にした感情グラフ |
| 「人体を地図に見立てて」 | 心臓ハブ、各臓器がノード、血管・神経がエッジのマップ |
| 「自社オフィスビルイベント用マップ」 | 各フロア・部署がゾーン、エレベーターが回廊ノード |

### 4-3. 生成パイプライン設計

```
[ユーザー入力: テーマ・規模・雰囲気]
         ↓
[Step 1] Web リサーチ & ソース収集
  - 複数ソース（検索結果・まとめ記事・SNS）を参照
  - API 固定ではなく「LLM + Web検索の自由度重視型」

         ↓
[Step 2] LLM によるノード候補抽出
  - 各エンティティに importance・cluster・rarity を付与
  - 共通ノードスキーマに変換

         ↓
[Step 3] クラスター分類 & グラフ骨格生成
  - importance 上位をハブノードに配置
  - クラスター内 Dense 接続、クラスター間 2〜3 本の回廊
  - バランス検証（連結性・最短距離分布・偏りスコア）

         ↓
[Step 4] プレビュー & チューニング UI
  - 生成マップをブラウザで即時可視化
  - スライダーで「分岐率・ループ密度・ハブ数」を調整
  - 「再生成」「特定ノード削除」「回廊追加」のインタラクティブ操作

         ↓
[Step 5] 確定 → ゲーム開始
  - マップIDを発行して保存・共有が可能
```

### 4-4. 技術的差別化ポイント

**「意味ベースの接続」:** 地理座標でなく LLM が判断する「意味的近接性」でエッジを張る。下北沢の「老舗スパイス系」と「新進気鋭インド系」は近く繋がり、「チェーン系ファストフード」は遠くに孤島化する、という意味論的マップが自動生成される。

**「ゲーム性バランス保証」:** 完全ランダム生成ではなく、生成後に**シミュレーション（1000回自動プレイ）**を走らせ、平均ターン数・逆転率・最短勝利数を算出。閾値を外れたマップは自動再生成。

**「マップID 共有」:** 承認されたマップはIDで保存・共有できる。「この居酒屋マップ、友達にもやらせてみたい」という口コミ体験を設計。

### 4-5. フェーズロードマップ

| フェーズ | 内容 | 目標時期 |
|---------|------|---------|
| Ph3-a | ノード定義 JSON のスキーマ確定 + 手動入力でのマップ定義UI | TBD |
| Ph3-b | LLM プロンプト → ノードリスト出力のプロトタイプ | TBD |
| Ph3-c | グラフ骨格生成 + バランス検証アルゴリズム | TBD |
| Ph3-d | プレビュー & チューニングUI 実装 | TBD |
| Ph3-e | マップID保存・公開機能 | TBD |

---

## 5. 競合比較と優位性

| 特徴 | 本プロジェクト | 桃鉄（商業） | 汎用ボードゲームサイト |
|------|--------------|------------|-------------------|
| ブラウザ即プレイ | ✅ | ❌（アプリ必要） | △（一部） |
| 独自テーマのマップ | ✅（Ph3） | ❌ | ❌ |
| 複数ゲームモード | ✅（2モード） | △ | ✅ |
| インストール不要 | ✅ | ❌ | △ |
| 無料 | ✅ | ❌ | △ |
| AIマップ生成 | ✅（Ph3予定） | ❌ | ❌ |

---

## 6. ターゲットユーザー

**一次ターゲット:** ゲーム好きなZ世代〜ミレニアル世代。オンラインコール中や同じ部屋で「ながら」プレイが主な場面を想定。

**二次ターゲット（Ph3以降）:** 地域コミュニティ、企業イベント担当、観光協会など、**「自分たちのテーマでボードゲームを作りたい」** 需要者。

---

## 7. 現在の実装状況サマリー

| 機能 | 状況 |
|------|------|
| グラフ型マップエンジン | ✅ 完成 |
| マルチプレイ（ローカル） | ✅ 完成 |
| クラシックモード（物件・資産） | ✅ 完成 |
| お宝争奪モード | ✅ 完成 |
| 3種の専用マップ | ✅ 完成 |
| カードシステム（6種） | ✅ 完成 |
| CPU AI | ✅ 完成 |
| ゲームログ（リアルタイム） | ✅ 完成 |
| Firebase Hosting 公開 | ✅ 稼働中 |
| マップ自動生成エンジン | 🔲 Ph3 企画中 |
| オンラインマルチプレイ | 🔲 将来検討 |

---

## 8. まとめ

「ぺぺ鉄道」は、サイコロとマップという普遍的なゲーム文法を土台に、**モード・マップ・テーマを替えることで無限に再生産可能なボードゲームプラットフォーム**を目指している。Ph1・Ph2 で基幹エンジンの実証は完了。Ph3 では「誰でも10分でボードゲームを召喚できる」UX を実現し、コンテンツ爆発的增殖を目論む。

> **「地図さえあれば、どんなものでもゲームになる」**

---

*本企画書は 2026年2月現在の実装・企画状況に基づく。仕様は開発進行に伴い変更される場合がある。*
